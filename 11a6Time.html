<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>App Th·ªùi Gian</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, pink, #ffe6f2);
    }
    header {
      background: #c71585;
      color: white;
      text-align: center;
      padding: 15px;
      font-size: 22px;
      font-weight: bold;
    }
    nav {
      display: flex;
      justify-content: space-around;
      background: #f8c0d8;
      padding: 10px;
      position: fixed;
      bottom: 0;
      width: 100%;
    }
    nav button {
      flex: 1;
      margin: 0 5px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      background: #fff;
      font-weight: bold;
    }
    section {
      display: none;
      padding: 20px;
    }
    .active {
      display: block;
    }
    .box {
      border: 2px solid #c71585;
      border-radius: 10px;
      padding: 15px;
      margin: 10px 0;
      background: #fff;
    }
    #clock {
      font-size: 40px;
      text-align: center;
      margin: 10px 0;
    }
    .task {
      display: flex;
      justify-content: space-between;
      padding: 5px;
      border-bottom: 1px solid #ccc;
    }
    .task button {
      margin-left: 5px;
    }
    table {
      border-collapse: collapse;
      margin: auto;
      width: 100%;
    }
    th, td {
      border: 1px solid #c71585;
      padding: 8px;
      text-align: center;
      vertical-align: top;
      height: 60px;
    }
    .calendar-nav {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
    }
    .lunar {
      font-size: 11px;
      color: #c71585;
    }
  </style>
</head>
<body>
  <header>App Th·ªùi Gian</header>

  <!-- ƒê·ªìng h·ªì -->
  <section id="clockSection" class="active">
    <div class="box">
      <h2>ƒê·ªìng h·ªì</h2>
      <div id="clock"></div>
      <div>
        <button onclick="startStopwatch()">Start Stopwatch</button>
        <button onclick="stopStopwatch()">Stop</button>
        <button onclick="clearStopwatch()">Clear</button>
      </div>
      <div id="stopwatch">00:00:00</div>
    </div>
  </section>

  <!-- Qu·∫£n l√Ω -->
  <section id="tasksSection">
    <div class="box">
      <h2>Qu·∫£n l√Ω th·ªùi gian</h2>
      <input type="text" id="taskInput" placeholder="Nh·∫≠p c√¥ng vi·ªác...">
      <button onclick="addTask()">Th√™m</button>
      <div id="taskList"></div>
    </div>
  </section>

  <!-- L·ªãch -->
  <section id="calendarSection">
    <div class="box">
      <h2>L·ªãch</h2>
      <div class="calendar-nav">
        <button onclick="prevMonth()">‚¨ÖÔ∏è</button>
        <div id="monthYear"></div>
        <button onclick="nextMonth()">‚û°Ô∏è</button>
      </div>
      <div id="calendar"></div>
    </div>
  </section>

  <nav>
    <button onclick="showSection('clockSection')">üïë ƒê·ªìng h·ªì</button>
    <button onclick="showSection('tasksSection')">üìã Qu·∫£n l√Ω</button>
    <button onclick="showSection('calendarSection')">üìÖ L·ªãch</button>
  </nav>

<script>
  // ƒê·ªìng h·ªì
  function updateClock() {
    let now = new Date();
    document.getElementById('clock').innerText = now.toLocaleTimeString();
  }
  setInterval(updateClock, 1000);

  // Stopwatch
  let stopwatchInterval, stopwatchTime = 0;
  function updateStopwatch() {
    stopwatchTime++;
    let hrs = String(Math.floor(stopwatchTime/3600)).padStart(2,'0');
    let mins = String(Math.floor((stopwatchTime%3600)/60)).padStart(2,'0');
    let secs = String(stopwatchTime%60).padStart(2,'0');
    document.getElementById('stopwatch').innerText = `${hrs}:${mins}:${secs}`;
  }
  function startStopwatch() {
    if(!stopwatchInterval) stopwatchInterval = setInterval(updateStopwatch, 1000);
  }
  function stopStopwatch() {
    clearInterval(stopwatchInterval);
    stopwatchInterval = null;
  }
  function clearStopwatch() {
    stopStopwatch();
    stopwatchTime = 0;
    document.getElementById('stopwatch').innerText = "00:00:00";
  }

  // Qu·∫£n l√Ω c√¥ng vi·ªác
  function addTask() {
    let taskInput = document.getElementById('taskInput');
    let task = taskInput.value.trim();
    if(task){
      let div = document.createElement('div');
      div.className = 'task';
      div.innerHTML = `${task} 
        <span>
          <button onclick="doneTask(this)">‚úÖ</button>
          <button onclick="deleteTask(this)">‚ùé</button>
        </span>`;
      document.getElementById('taskList').appendChild(div);
      taskInput.value = '';
    }
  }
  function doneTask(btn){
    btn.parentElement.parentElement.style.textDecoration = "line-through";
  }
  function deleteTask(btn){
    btn.parentElement.parentElement.remove();
  }

  // ======== L·ªäCH D∆Ø∆†NG + √ÇM =========
  let today = new Date();
  let currentMonth = today.getMonth();
  let currentYear = today.getFullYear();

  // Thu·∫≠t to√°n √¢m l·ªãch (simple version)
  function jdFromDate(dd, mm, yy) {
    let a = Math.floor((14 - mm) / 12);
    let y = yy+4800-a;
    let m = mm+12*a-3;
    let jd = dd + Math.floor((153*m+2)/5) + 365*y + Math.floor(y/4) - Math.floor(y/100) + Math.floor(y/400) - 32045;
    if (jd < 2299161) jd = dd + Math.floor((153*m+2)/5) + 365*y + Math.floor(y/4) - 32083;
    return jd;
  }
  function jdToDate(jd) {
    let a, b, c, d, e, m, day, month, year;
    if (jd > 2299160) {
      a = jd + 32044;
      b = Math.floor((4*a+3)/146097);
      c = a - Math.floor((b*146097)/4);
    } else {
      b = 0;
      c = jd + 32082;
    }
    d = Math.floor((4*c+3)/1461);
    e = c - Math.floor((1461*d)/4);
    m = Math.floor((5*e+2)/153);
    day = e - Math.floor((153*m+2)/5) + 1;
    month = m + 3 - 12*Math.floor(m/10);
    year = b*100 + d - 4800 + Math.floor(m/10);
    return [day, month, year];
  }
  function getNewMoonDay(k, timeZone) {
    let T = k/1236.85;
    let T2 = T*T; let T3 = T2*T;
    let dr = Math.PI/180;
    let Jd1 = 2415020.75933 + 29.53058868*k + 0.0001178*T2 - 0.000000155*T3;
    Jd1 += 0.00033*Math.sin((166.56+132.87*T-0.009173*T2)*dr);
    let M = 359.2242+29.10535608*k-0.0000333*T2-0.00000347*T3;
    let Mpr = 306.0253+385.81691806*k+0.0107306*T2+0.00001236*T3;
    let F = 21.2964+390.67050646*k-0.0016528*T2-0.00000239*T3;
    let C1=(0.1734-0.000393*T)*Math.sin(M*dr)+0.0021*Math.sin(2*dr*M);
    C1-=(0.4068)*Math.sin(Mpr*dr)+0.0161*Math.sin(dr*2*Mpr);
    C1-=0.0004*Math.sin(dr*3*Mpr)+0.0104*Math.sin(dr*2*F);
    C1-=0.0051*Math.sin(dr*(M+Mpr))+0.0074*Math.sin(dr*(M-Mpr));
    C1+=0.0004*Math.sin(dr*(2*F+M))+0.0004*Math.sin(dr*(2*F-M));
    C1-=0.0006*Math.sin(dr*(2*F+Mpr))+0.0010*Math.sin(dr*(2*F-Mpr));
    C1+=0.0005*Math.sin(dr*(2*Mpr+M));
    let deltat;
    if (T < -11) {
      deltat=0.001+0.000839*T+0.0002261*T2-0.00000845*T3-0.000000081*T*T3;
    } else {
      deltat=-0.000278+0.000265*T+0.000262*T2;
    }
    let JdNew = Jd1 + C1 - deltat;
    return Math.floor(JdNew+0.5+timeZone/24);
  }
  function getSunLongitude(jdn, timeZone) {
    let T = (jdn - 2451545.5 - timeZone/24) / 36525;
    let T2 = T*T;
    let dr = Math.PI/180;
    let M = 357.52910 + 35999.05030*T - 0.0001559*T2 - 0.00000048*T*T2;
    let L0 = 280.46645 + 36000.76983*T + 0.0003032*T2;
    let DL = (1.914600 - 0.004817*T - 0.000014*T2)*Math.sin(dr*M);
    DL += (0.019993 - 0.000101*T)*Math.sin(dr*2*M) + 0.000290*Math.sin(dr*3*M);
    let L = L0+DL;
    let omega = 125.04-1934.136*T;
    L = L - 0.00569 - 0.00478*Math.sin(omega*dr);
    L = L*dr; L = L - 2*Math.PI*Math.floor(L/(2*Math.PI));
    return Math.floor(L/Math.PI*6);
  }
  function getLunarDate(dd, mm, yy, timeZone) {
    let dayNumber = jdFromDate(dd, mm, yy);
    let k = Math.floor((dayNumber - 2415021.076998695)/29.530588853);
    let monthStart = getNewMoonDay(k+1, timeZone);
    if (monthStart > dayNumber) monthStart = getNewMoonDay(k, timeZone);
    let a11 = getLunarMonth11(yy, timeZone);
    let b11 = a11;
    let lunarYear;
    if (a11 >= monthStart) {
      a11 = getLunarMonth11(yy-1, timeZone);
      lunarYear = yy;
    } else {
      b11 = getLunarMonth11(yy+1, timeZone);
      lunarYear = yy+1;
    }
    let lunarDay = dayNumber-monthStart+1;
    let diff = Math.floor((monthStart - a11)/29);
    let lunarMonth = diff+11;
    if (b11 - a11 > 365) {
      let leapMonthDiff = getLeapMonthOffset(a11, timeZone);
      if (diff >= leapMonthDiff) {
        lunarMonth = diff+10;
      }
    }
    if (lunarMonth > 12) {
      lunarMonth = lunarMonth-12;
    }
    if (lunarMonth >= 11 && diff < 4) {
      lunarYear -= 1;
    }
    return [lunarDay, lunarMonth, lunarYear];
  }
  function getLunarMonth11(yy, timeZone) {
    let off = jdFromDate(31, 12, yy) - 2415021;
    let k = Math.floor(off / 29.530588853);
    let nm = getNewMoonDay(k, timeZone);
    let sunLong = getSunLongitude(nm, timeZone);
    if (sunLong >= 9) nm = getNewMoonDay(k-1, timeZone);
    return nm;
  }
  function getLeapMonthOffset(a11, timeZone) {
    let k = Math.floor(0.5+(a11-2415021.076998695)/29.530588853);
    let last = 0; let i = 1;
    let arc = getSunLongitude(getNewMoonDay(k+i, timeZone), timeZone);
    do {
      last = arc;
      i++;
      arc = getSunLongitude(getNewMoonDay(k+i, timeZone), timeZone);
    } while (arc != last && i < 14);
    return i-1;
  }

  function renderCalendar(month, year) {
    let firstDay = new Date(year, month).getDay();
    let daysInMonth = new Date(year, month+1, 0).getDate();
    let tbl = "<table><tr><th>CN</th><th>T2</th><th>T3</th><th>T4</th><th>T5</th><th>T6</th><th>T7</th></tr><tr>";
    for(let i=0; i<firstDay; i++) tbl += "<td></td>";
    for(let d=1; d<=daysInMonth; d++){
      if((firstDay+d-1)%7==0 && d>1) tbl += "</tr><tr>";
      let lunar = getLunarDate(d, month+1, year, 7); // VN time zone = 7
      tbl += `<td>${d}<div class="lunar">${lunar[0]}/${lunar[1]}</div></td>`;
    }
    tbl += "</tr></table>";
    document.getElementById("calendar").innerHTML = tbl;
    document.getElementById("monthYear").innerText = `Th√°ng ${month+1}/${year}`;
  }
  function prevMonth(){
    currentMonth--;
    if(currentMonth<0){ currentMonth=11; currentYear--; }
    renderCalendar(currentMonth,currentYear);
  }
  function nextMonth(){
    currentMonth++;
    if(currentMonth>11){ currentMonth=0; currentYear++; }
    renderCalendar(currentMonth,currentYear);
  }
  renderCalendar(currentMonth,currentYear);

  // Chuy·ªÉn tab
  function showSection(id) {
    document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");
  }
</script>
</body>
                                                </html>
